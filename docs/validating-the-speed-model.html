<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>18 Validating the Speed Model | Visualising WRC Telemetry Data With R</title>
  <meta name="description" content="Analysing WRC telemetry data." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="18 Validating the Speed Model | Visualising WRC Telemetry Data With R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Analysing WRC telemetry data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="18 Validating the Speed Model | Visualising WRC Telemetry Data With R" />
  
  <meta name="twitter:description" content="Analysing WRC telemetry data." />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="smoothing-a-route.html"/>
<link rel="next" href="numbering-corners.html"/>
<script src="libs/header-attrs-2.11.22/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.0/leaflet-providers-plugin.js"></script>
<script data-goatcounter="https://rallydatajunkie.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualing WRC Telemetry</strong></a></li>

<li class="divider"></li>
<li><a href="index.html#preface">Preface<span></span></a></li>
<li class="chapter" data-level="1" data-path="introducing-wrc-telemetry.html"><a href="introducing-wrc-telemetry.html"><i class="fa fa-check"></i><b>1</b> Introducing WRC Telemetry<span></span></a></li>
<li class="chapter" data-level="2" data-path="loading-the-live-telemetry-route-data.html"><a href="loading-the-live-telemetry-route-data.html"><i class="fa fa-check"></i><b>2</b> Loading the Live Telemetry Route Data<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="loading-the-live-telemetry-route-data.html"><a href="loading-the-live-telemetry-route-data.html#spatial-utilities"><i class="fa fa-check"></i><b>2.1</b> Spatial Utilities<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="loading-the-live-telemetry-route-data.html"><a href="loading-the-live-telemetry-route-data.html#loading-in-the-telemetry-route-data"><i class="fa fa-check"></i><b>2.2</b> Loading in the Telemetry Route Data<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="loading-the-live-telemetry-route-data.html"><a href="loading-the-live-telemetry-route-data.html#preparing-the-telemetry-route-data"><i class="fa fa-check"></i><b>2.3</b> Preparing the Telemetry Route Data<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="loading-the-live-telemetry-route-data.html"><a href="loading-the-live-telemetry-route-data.html#visual-preview-of-the-telemetry-route-data"><i class="fa fa-check"></i><b>2.4</b> Visual Preview of the Telemetry Route Data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-official-route-data.html"><a href="using-official-route-data.html"><i class="fa fa-check"></i><b>3</b> Using Official Route Data<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="using-official-route-data.html"><a href="using-official-route-data.html#loading-official-stage-route-data"><i class="fa fa-check"></i><b>3.1</b> Loading Official Stage Route Data<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="using-official-route-data.html"><a href="using-official-route-data.html#comparing-stage-route-telemetry-and-the-stage-route"><i class="fa fa-check"></i><b>3.2</b> Comparing Stage Route Telemetry and the Stage Route<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="telemetry-data-along-a-stage.html"><a href="telemetry-data-along-a-stage.html"><i class="fa fa-check"></i><b>4</b> Telemetry Data Along a Stage<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="telemetry-data-along-a-stage.html"><a href="telemetry-data-along-a-stage.html#finding-points-on-the-route-closest-to-the-telemetry-data-locations"><i class="fa fa-check"></i><b>4.1</b> Finding Points on the Route Closest to the Telemetry Data Locations<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plotting-locations-a-certain-time-into-the-stage.html"><a href="plotting-locations-a-certain-time-into-the-stage.html"><i class="fa fa-check"></i><b>5</b> Plotting Locations a Certain Time Into the Stage<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="plotting-locations-a-certain-time-into-the-stage.html"><a href="plotting-locations-a-certain-time-into-the-stage.html#find-the-stage-telemetry-time-series-origin"><i class="fa fa-check"></i><b>5.1</b> Find the Stage Telemetry Time Series Origin<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="plotting-locations-a-certain-time-into-the-stage.html"><a href="plotting-locations-a-certain-time-into-the-stage.html#estimating-the-start-time"><i class="fa fa-check"></i><b>5.1.1</b> Estimating the Start Time<span></span></a></li>
<li class="chapter" data-level="5.1.2" data-path="plotting-locations-a-certain-time-into-the-stage.html"><a href="plotting-locations-a-certain-time-into-the-stage.html#using-a-false-origin"><i class="fa fa-check"></i><b>5.1.2</b> Using a False Origin<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="plotting-locations-a-certain-time-into-the-stage.html"><a href="plotting-locations-a-certain-time-into-the-stage.html#plotting-the-stage-telemetry-time-series"><i class="fa fa-check"></i><b>5.2</b> Plotting the Stage Telemetry Time Series<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interpolating-times-along-the-route.html"><a href="interpolating-times-along-the-route.html"><i class="fa fa-check"></i><b>6</b> Interpolating Times Along the Route<span></span></a></li>
<li class="chapter" data-level="7" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html"><i class="fa fa-check"></i><b>7</b> Comparing Drivers’ Live (Sparse) Telemetry<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#load-route-data"><i class="fa fa-check"></i><b>7.1</b> Load Route Data<span></span></a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#generate-buffered-route"><i class="fa fa-check"></i><b>7.1.1</b> Generate Buffered Route<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#load-driver-data"><i class="fa fa-check"></i><b>7.2</b> Load Driver Data<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#get-annotated-route-telemetry"><i class="fa fa-check"></i><b>7.3</b> Get Annotated Route Telemetry<span></span></a></li>
<li class="chapter" data-level="7.4" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#create-driver-estimators"><i class="fa fa-check"></i><b>7.4</b> Create Driver Estimators<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#creating-a-common-false-time-origin"><i class="fa fa-check"></i><b>7.5</b> Creating a Common False Time Origin<span></span></a></li>
<li class="chapter" data-level="7.6" data-path="comparing-drivers-live-sparse-telemetry.html"><a href="comparing-drivers-live-sparse-telemetry.html#visual-driver-comparison"><i class="fa fa-check"></i><b>7.6</b> Visual Driver Comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="finding-the-time-to-complete-a-particular-stretch.html"><a href="finding-the-time-to-complete-a-particular-stretch.html"><i class="fa fa-check"></i><b>8</b> Finding the Time to Complete a Particular Stretch<span></span></a></li>
<li class="chapter" data-level="9" data-path="estimating-time-deltas-between-drivers-over-small-sections.html"><a href="estimating-time-deltas-between-drivers-over-small-sections.html"><i class="fa fa-check"></i><b>9</b> Estimating Time Deltas Between Drivers Over Small Sections<span></span></a></li>
<li class="chapter" data-level="10" data-path="interpolation-using-a-route-speed-model.html"><a href="interpolation-using-a-route-speed-model.html"><i class="fa fa-check"></i><b>10</b> Interpolation Using A Route Speed Model<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="interpolation-using-a-route-speed-model.html"><a href="interpolation-using-a-route-speed-model.html#creating-a-route-speed-model"><i class="fa fa-check"></i><b>10.1</b> Creating a Route Speed Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="full-telemetry.html"><a href="full-telemetry.html"><i class="fa fa-check"></i><b>11</b> Full telemetry<span></span></a></li>
<li class="chapter" data-level="12" data-path="generating-a-trajr-route-from-the-telemetry-data.html"><a href="generating-a-trajr-route-from-the-telemetry-data.html"><i class="fa fa-check"></i><b>12</b> Generating a <code>trajr</code> Route From the Telemetry Data<span></span></a></li>
<li class="chapter" data-level="13" data-path="finding-distance-into-a-common-route.html"><a href="finding-distance-into-a-common-route.html"><i class="fa fa-check"></i><b>13</b> Finding Distance into a Common Route<span></span></a></li>
<li class="chapter" data-level="14" data-path="looking-at-braking-behaviour.html"><a href="looking-at-braking-behaviour.html"><i class="fa fa-check"></i><b>14</b> Looking At Braking Behaviour<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="looking-at-braking-behaviour.html"><a href="looking-at-braking-behaviour.html#throttle-comparison"><i class="fa fa-check"></i><b>14.1</b> Throttle Comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="comparing-times-into-stage.html"><a href="comparing-times-into-stage.html"><i class="fa fa-check"></i><b>15</b> Comparing Times Into Stage<span></span></a></li>
<li class="chapter" data-level="16" data-path="correlating-telemetry-traces.html"><a href="correlating-telemetry-traces.html"><i class="fa fa-check"></i><b>16</b> Correlating Telemetry Traces<span></span></a></li>
<li class="chapter" data-level="17" data-path="smoothing-a-route.html"><a href="smoothing-a-route.html"><i class="fa fa-check"></i><b>17</b> Smoothing a Route<span></span></a></li>
<li class="chapter" data-level="18" data-path="validating-the-speed-model.html"><a href="validating-the-speed-model.html"><i class="fa fa-check"></i><b>18</b> Validating the Speed Model<span></span></a></li>
<li class="chapter" data-level="19" data-path="numbering-corners.html"><a href="numbering-corners.html"><i class="fa fa-check"></i><b>19</b> Numbering Corners<span></span></a></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Telemetry Data With R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="validating-the-speed-model" class="section level1 hasAnchor" number="18">
<h1><span class="header-section-number">18</span> Validating the Speed Model<a href="validating-the-speed-model.html#validating-the-speed-model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We can use the telemetry from a route to validate (or not!) our speed model. So let’s have a go at that…</p>
<p>We already have a stage route available, so let’s recap how to generate the speed model from a stage route. To ty to improve the model, we can use the smmoothed route. For many parts of the stage, the smoothed route is likely to give a better estimate of the line. However, for certain stage features, such as hairpins, the smoothing may be over-optimistic and take an impossible line.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="validating-the-speed-model.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">#stepdist = 10</span></span>
<span id="cb136-2"><a href="validating-the-speed-model.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co">#window = 20</span></span>
<span id="cb136-3"><a href="validating-the-speed-model.html#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="validating-the-speed-model.html#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Original route: stage_route_utm</span></span>
<span id="cb136-5"><a href="validating-the-speed-model.html#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Smooth route: smooth_route_utm</span></span>
<span id="cb136-6"><a href="validating-the-speed-model.html#cb136-6" aria-hidden="true" tabindex="-1"></a>route_ <span class="ot">=</span> smooth_route_utm</span>
<span id="cb136-7"><a href="validating-the-speed-model.html#cb136-7" aria-hidden="true" tabindex="-1"></a>route_convexity <span class="ot">=</span> <span class="fu">get_route_convexity</span>(route_, stepdist, window) <span class="sc">%&gt;%</span> </span>
<span id="cb136-8"><a href="validating-the-speed-model.html#cb136-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">radius =</span> <span class="fu">curvatures</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-9"><a href="validating-the-speed-model.html#cb136-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">corner_speed_model</span>(<span class="at">speed_modifier=</span><span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-10"><a href="validating-the-speed-model.html#cb136-10" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">acceleration_model</span>(<span class="at">acc=</span><span class="fl">0.1</span>, <span class="at">dec=</span><span class="fl">0.05</span>)</span>
<span id="cb136-11"><a href="validating-the-speed-model.html#cb136-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-12"><a href="validating-the-speed-model.html#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate speed points at same sample distances as in speed model</span></span>
<span id="cb136-13"><a href="validating-the-speed-model.html#cb136-13" aria-hidden="true" tabindex="-1"></a>sample_points <span class="ot">=</span> route_convexity<span class="sc">$</span>cum_dist</span></code></pre></div>
<p>To validate the model, we need to ensure that we are testing the telemetry within the buffered route area and also ensure we are using similar sample distances.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="validating-the-speed-model.html#cb137-1" aria-hidden="true" tabindex="-1"></a>buffer_width <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb137-2"><a href="validating-the-speed-model.html#cb137-2" aria-hidden="true" tabindex="-1"></a>buffered_route <span class="ot">=</span> <span class="fu">get_buffered_route</span>(stage_route_utm, buffer_width,</span>
<span id="cb137-3"><a href="validating-the-speed-model.html#cb137-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">crs=</span>original_crs, <span class="at">utm=</span><span class="cn">FALSE</span>)</span>
<span id="cb137-4"><a href="validating-the-speed-model.html#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="validating-the-speed-model.html#cb137-5" aria-hidden="true" tabindex="-1"></a>telem_df_full_test_utm <span class="ot">=</span> <span class="fu">get_full_telem</span>(<span class="fu">file.path</span>(path, fn), <span class="at">utm=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-6"><a href="validating-the-speed-model.html#cb137-6" aria-hidden="true" tabindex="-1"></a>buffered_telem_test_utm <span class="ot">=</span> <span class="fu">get_route_telem</span>(stage_route_utm,</span>
<span id="cb137-7"><a href="validating-the-speed-model.html#cb137-7" aria-hidden="true" tabindex="-1"></a>                                          telem_df_full_test_utm)</span>
<span id="cb137-8"><a href="validating-the-speed-model.html#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="validating-the-speed-model.html#cb137-9" aria-hidden="true" tabindex="-1"></a>trj_buffered_test <span class="ot">=</span> buffered_telem_test_utm <span class="sc">%&gt;%</span></span>
<span id="cb137-10"><a href="validating-the-speed-model.html#cb137-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">telemetry_full_trajectory</span>() <span class="sc">%&gt;%</span></span>
<span id="cb137-11"><a href="validating-the-speed-model.html#cb137-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">dist_into_route =</span> <span class="fu">dist_into_route</span>(., stage_route_utm))</span>
<span id="cb137-12"><a href="validating-the-speed-model.html#cb137-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-13"><a href="validating-the-speed-model.html#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate based on telemetry</span></span>
<span id="cb137-14"><a href="validating-the-speed-model.html#cb137-14" aria-hidden="true" tabindex="-1"></a>test_speeds <span class="ot">=</span> <span class="fu">ts_estimator</span>(trj_buffered_test,</span>
<span id="cb137-15"><a href="validating-the-speed-model.html#cb137-15" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;cum_dist&quot;</span>, <span class="st">&quot;speed&quot;</span>, sample_points)</span>
<span id="cb137-16"><a href="validating-the-speed-model.html#cb137-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-17"><a href="validating-the-speed-model.html#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="co">#test_speeds = test_estimator(sample_points)</span></span></code></pre></div>
<p>We can plot the actual speed (as captured telemetry) along with the interpolated speed at regular points along the stage to check the behaviour of the interpolator.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="validating-the-speed-model.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just quickly check that the sample speed model approximates the raw data</span></span>
<span id="cb138-2"><a href="validating-the-speed-model.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb138-3"><a href="validating-the-speed-model.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>trj_buffered_test,</span>
<span id="cb138-4"><a href="validating-the-speed-model.html#cb138-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x=</span>dist_into_route, <span class="at">y=</span>speed)) <span class="sc">+</span></span>
<span id="cb138-5"><a href="validating-the-speed-model.html#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_speeds),</span>
<span id="cb138-6"><a href="validating-the-speed-model.html#cb138-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;red&#39;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-67-1.png" width="672" /></p>
<p>Comparing the traces, the simple estimator appears to do a reasonable job of interpolating speeds between the sample points, which means we can get a reasonable estimate of speed, from the telemetry, at any point along the route.</p>
<p>How well does the time into stage interpolation work (which is to say: can we reliably interpolate the time into stage from a telemetry based model)?</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="validating-the-speed-model.html#cb139-1" aria-hidden="true" tabindex="-1"></a>test_times <span class="ot">=</span> <span class="fu">ts_estimator</span>(trj_buffered_test,</span>
<span id="cb139-2"><a href="validating-the-speed-model.html#cb139-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;cum_dist&quot;</span>, <span class="st">&quot;displacementTime&quot;</span>, sample_points)</span>
<span id="cb139-3"><a href="validating-the-speed-model.html#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="validating-the-speed-model.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb139-5"><a href="validating-the-speed-model.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>trj_buffered_test,</span>
<span id="cb139-6"><a href="validating-the-speed-model.html#cb139-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x=</span>dist_into_route, <span class="at">y=</span>displacementTime)) <span class="sc">+</span></span>
<span id="cb139-7"><a href="validating-the-speed-model.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_times),</span>
<span id="cb139-8"><a href="validating-the-speed-model.html#cb139-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;red&#39;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-68-1.png" width="672" /></p>
<p>Again, that looks reasonable.</p>
<p>Now let’s see how our simple speed model works. To begin with, how well do the speeds predicted by the speed model, based on stage route analysis, compared with speeds captured from telemetry?</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="validating-the-speed-model.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just quickly check that the sample speed model approximates the raw data</span></span>
<span id="cb140-2"><a href="validating-the-speed-model.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb140-3"><a href="validating-the-speed-model.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>route_convexity,</span>
<span id="cb140-4"><a href="validating-the-speed-model.html#cb140-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x=</span>cum_dist, <span class="at">y=</span>acc_sp)) <span class="sc">+</span></span>
<span id="cb140-5"><a href="validating-the-speed-model.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_speeds),</span>
<span id="cb140-6"><a href="validating-the-speed-model.html#cb140-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb140-7"><a href="validating-the-speed-model.html#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_speeds <span class="sc">-</span> route_convexity<span class="sc">$</span>acc_sp),</span>
<span id="cb140-8"><a href="validating-the-speed-model.html#cb140-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-69-1.png" width="672" /></p>
<p>We can also find a simple cross correlation between the speed model and some speed telemetry data:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="validating-the-speed-model.html#cb141-1" aria-hidden="true" tabindex="-1"></a>speed_correlation <span class="ot">=</span> <span class="fu">ccf</span>(route_convexity<span class="sc">$</span>acc_sp, test_speeds, <span class="at">na.action=</span>na.pass)</span></code></pre></div>
<p><img src="images/unnamed-chunk-70-1.png" width="672" /></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="validating-the-speed-model.html#cb142-1" aria-hidden="true" tabindex="-1"></a>speed_correlation</span></code></pre></div>
<pre><code>## 
## Autocorrelations of series &#39;X&#39;, by lag
## 
##    -29    -28    -27    -26    -25    -24    -23    -22    -21    -20    -19 
## -0.060 -0.049 -0.037 -0.025 -0.010  0.003  0.019  0.038  0.060  0.081  0.101 
##    -18    -17    -16    -15    -14    -13    -12    -11    -10     -9     -8 
##  0.118  0.136  0.157  0.183  0.202  0.220  0.242  0.262  0.283  0.308  0.335 
##     -7     -6     -5     -4     -3     -2     -1      0      1      2      3 
##  0.367  0.400  0.434  0.469  0.510  0.556  0.596  0.629  0.648  0.657  0.654 
##      4      5      6      7      8      9     10     11     12     13     14 
##  0.630  0.597  0.556  0.522  0.481  0.439  0.398  0.361  0.334  0.311  0.290 
##     15     16     17     18     19     20     21     22     23     24     25 
##  0.274  0.260  0.247  0.225  0.206  0.193  0.179  0.166  0.147  0.131  0.119 
##     26     27     28     29 
##  0.112  0.109  0.100  0.088</code></pre>
<p>The model is a bit rough, bit captures some of the major features, and gives us a crude approximation of speed.</p>
<p>Perhaps more important from the perspective of using the speed model as a basis for predictions of time into stage, let’s see how the time into stage prediction compares with the actual time into stage at particular locations as captured from telemetry:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="validating-the-speed-model.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb144-2"><a href="validating-the-speed-model.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>route_convexity,</span>
<span id="cb144-3"><a href="validating-the-speed-model.html#cb144-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">x=</span>cum_dist, <span class="at">y=</span>acc_time)) <span class="sc">+</span></span>
<span id="cb144-4"><a href="validating-the-speed-model.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_times),</span>
<span id="cb144-5"><a href="validating-the-speed-model.html#cb144-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb144-6"><a href="validating-the-speed-model.html#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_times <span class="sc">-</span> route_convexity<span class="sc">$</span>acc_time),</span>
<span id="cb144-7"><a href="validating-the-speed-model.html#cb144-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-71-1.png" width="672" /></p>
<p>There appear to be two types of error in the prediction: a general trend component error, where the prediction appears to drift consistently from the actual time into stage as captured from telemetry; and a possible difference in “shape” of the lines.</p>
<p>We can modify the model to account for the linear dirft by tweaking the cornering speed model. A trivial way to do this is to fettle the <code>speed_modifier</code> parameter in the <code>corner_speed_model()</code> function.</p>
<p>We can detrend the prediction error to get a feel how the “shape” of the predicted time drifts from the actual time. One way of detrending the data is to create a linear model of it and then inspect the residual error around that model.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="validating-the-speed-model.html#cb145-1" aria-hidden="true" tabindex="-1"></a>linear_time_model <span class="ot">=</span> <span class="fu">lm</span>((test_times <span class="sc">-</span> route_convexity<span class="sc">$</span>acc_time) <span class="sc">~</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(test_times)))</span>
<span id="cb145-2"><a href="validating-the-speed-model.html#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="validating-the-speed-model.html#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(linear_time_model), <span class="at">type=</span><span class="st">&quot;l&quot;</span>) </span></code></pre></div>
<p><img src="images/unnamed-chunk-72-1.png" width="672" /></p>
<p>By inspection of the elevation map for this stage, we may be lossing time in the model compared to the actual telemetry on downhill sections. The speed model does not currently take elevation / elevation change into account. But perhaps it should, particularly on downhill sections?</p>
<p>Another approach is to normalise the curves and then compare them:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="validating-the-speed-model.html#cb146-1" aria-hidden="true" tabindex="-1"></a>test_times_normalised <span class="ot">=</span> test_times <span class="sc">/</span> <span class="fu">max</span>(test_times, <span class="at">na.rm=</span>T)</span>
<span id="cb146-2"><a href="validating-the-speed-model.html#cb146-2" aria-hidden="true" tabindex="-1"></a>acc_time_normalised <span class="ot">=</span> route_convexity<span class="sc">$</span>acc_time <span class="sc">/</span> <span class="fu">max</span>(route_convexity<span class="sc">$</span>acc_time,</span>
<span id="cb146-3"><a href="validating-the-speed-model.html#cb146-3" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">na.rm=</span>T)</span>
<span id="cb146-4"><a href="validating-the-speed-model.html#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="validating-the-speed-model.html#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb146-6"><a href="validating-the-speed-model.html#cb146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>acc_time_normalised)) <span class="sc">+</span></span>
<span id="cb146-7"><a href="validating-the-speed-model.html#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_times_normalised),</span>
<span id="cb146-8"><a href="validating-the-speed-model.html#cb146-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-73-1.png" width="672" /></p>
<p>We can also compare the error between the actual times into stage and the predicted times, and the actual times into stage compared to a linear model.</p>
<p>If the error of the predicted time into stage is less than that of the linear model, then it adds some value to time predictions based on sparse telemetry.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="validating-the-speed-model.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb147-2"><a href="validating-the-speed-model.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points, <span class="at">y=</span>test_times_normalised <span class="sc">-</span> acc_time_normalised),</span>
<span id="cb147-3"><a href="validating-the-speed-model.html#cb147-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;blue&#39;</span>) <span class="sc">+</span> </span>
<span id="cb147-4"><a href="validating-the-speed-model.html#cb147-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>sample_points,</span>
<span id="cb147-5"><a href="validating-the-speed-model.html#cb147-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y=</span>acc_time_normalised <span class="sc">-</span> sample_points<span class="sc">/</span><span class="fu">max</span>(sample_points, <span class="at">na.rm=</span>T)),</span>
<span id="cb147-6"><a href="validating-the-speed-model.html#cb147-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-74-1.png" width="672" /></p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="smoothing-a-route.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="numbering-corners.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"info": true
});
});
</script>

</body>

</html>
